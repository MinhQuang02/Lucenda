{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recycle Bin - Lucenda</title>
  <link rel="icon" type="image/png" href="{% static 'images/logo.svg' %}">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Detail</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@275;400;500;600;700&family=Roboto:wght@400&family=Inter:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'event/recycle-bin-event/global.css' %}">
  <style id="sections-styles">
/* CSS for section section:header */
.site-header {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 10;
  background: linear-gradient(to left, rgba(220, 140, 216, 0.96), rgba(232, 150, 249, 0.96));
  height: var(--header-height);
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 100%;
  position: relative;
}

.logo {
  position: absolute;
  left: 20px;
  top: -27px;
  width: 129px;
  height: 129px;
  z-index: 11;
}

.logo img {
  width: 100%;
  height: 100%;
  transition: transform 0.3s ease;
  transform-origin: center center; /* phóng từ giữa ảnh */
  cursor: pointer;
}

.logo img:hover {
  transform: scale(1.05); /* phóng to ra ngoài, không bị cắt */
}

.main-nav {
  flex-grow: 1;
  margin-left: 165px; /* Space for the absolute positioned logo */
}

.main-nav ul {
  display: flex;
  gap: 40px;
}

.main-nav a {
  /* style_27 */
  font-size: 20px;
  font-weight: 500;
  /* NOTE: Text color from JSON is #ffffff, which has poor contrast on the light header background. Using a darker color for visibility based on the image. */
  color: #1f1f1f;
}

.profile-section {
  display: flex;
  align-items: center;
}

.profile-section a {
  display: flex;
  align-items: center;
  gap: 12px; /* khoảng cách giữa chữ và ảnh */
  text-decoration: none;
  color: inherit;
}

.profile-name {
  /* style_26 */
  font-size: 20px;
  font-weight: 500;
  /* NOTE: Text color from JSON is #ffffff. Using a darker color for visibility. */
  color: #1f1f1f;
}

.profile-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%; /* style_25 */
}

.mobile-nav-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 12;
}

.mobile-nav-toggle .bar {
    display: block;
    width: 25px;
    height: 3px;
    margin: 5px auto;
    background-color: #1f1f1f;
}

/* Responsive Header */
@media (max-width: 1024px) {
  .main-nav {
    margin-left: 180px;
  }
  .main-nav ul {
    gap: 20px;
  }
}

@media (max-width: 880px) {
  .main-nav, .profile-section {
    display: none; /* Hide for mobile, to be handled by JS */
  }
  .mobile-nav-toggle {
    display: block;
  }
  .header-container {
    justify-content: flex-end;
  }
  .logo {
    left: 30px;
    width: 100px;
    height: 100px;
    top: -10px;
  }
}
.site-header {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 10;
  background: linear-gradient(to left, rgba(220, 140, 216, 0.96), rgba(232, 150, 249, 0.96));
  height: var(--header-height);
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 100%;
  position: relative;
}

.logo {
  position: absolute;
  left: 20px;
  top: -27px; /* Hangs off the top based on Figma coordinates */
  width: 129px;
  height: 129px;
  z-index: 11;
}

.logo img {
  width: 100%;
  height: 100%;
}

.main-nav {
  flex-grow: 1;
  margin-left: 165px; /* Space for the absolute positioned logo */
}

.main-nav ul {
  display: flex;
  gap: 40px;
}

.main-nav a {
  font-size: 18px;
  font-weight: 500;
  color: #1f1f1f; /* chữ trắng tím nhạt */
  position: relative;
  transition: color 0.3s ease;
}

.main-nav a::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 0;
  height: 2px;
  background: #b62db6ff;
  transition: width 0.3s ease;
}

.main-nav a:hover {
  color: #b62db6ff; /* tím nhạt sáng hơn khi hover */
}

.main-nav a:hover::after {
  width: 100%; /* gạch chân tím khi hover */
}

.profile-section a {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  color: #1f1f1f;
  transition: color 0.3s ease, transform 0.2s ease;
}

.profile-section a:hover {
  color: #b62db6ff;
  transform: translateY(-1px); /* nổi nhẹ khi hover */
}

.profile-name {
  font-size: 18px;
  font-weight: 500;
}

.profile-avatar {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #b62db6ff;
  padding: 2px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform 0.3s ease;
}

.profile-avatar:hover {
  transform: scale(1.1);
}

.mobile-nav-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 12;
}

.mobile-nav-toggle .bar {
    display: block;
    width: 25px;
    height: 3px;
    margin: 5px auto;
    background-color: #1f1f1f;
}

/* Responsive Header */
@media (max-width: 1024px) {
  .main-nav {
    margin-left: 180px;
  }
  .main-nav ul {
    gap: 20px;
  }
}

@media (max-width: 880px) {
  .main-nav, .profile-section {
    display: none; /* Hide for mobile, to be handled by JS */
  }
  .mobile-nav-toggle {
    display: block;
  }
  .header-container {
    justify-content: flex-end;
  }
  .logo {
    left: 30px;
    width: 100px;
    height: 100px;
    top: -10px;
  }
}

/* CSS for section section:event-view */
.event-view-wrapper {
    display: flex;
    min-height: calc(100vh - 86px); /* Full height minus header */
    margin-top: 82px;
  }

  .sidebar {
    width: 262px;
    flex-shrink: 0;
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .sidebar-top {
    padding: 27px 20px 0;
  }

  .calendar-widget {
    padding-bottom: 27px;
  }

  .calendar-header {
    display: flex;
    align-items: center;
    gap: 7px;
    margin-bottom: 10px;
  }

  .calendar-header h2 {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-light);
    margin: 0;
  }

  .calendar-header .year {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px 4px;
    text-align: center;
  }

  .day-name {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-light);
    opacity: 0.7;
    text-transform: capitalize;
  }

  .date-num {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-light);
    padding: 5px;
    border-radius: 99px;
  }

  .date-num.today {
    background: linear-gradient(135deg, #e4d4f8, #c1a3e7); /* tím nhạt -> tím đậm */
    color: white;
    font-weight: bold;
  }

  .date-num.active {
    background-color: var(--primary-color);
    color: var(--text-white);
  }

  .date-num.dimmed  {
    opacity: 0.3;
  }

  .events-section {
    border-top: 1px solid var(--border-color);
  }

  .events-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .events-title {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .events-title h3 {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-light);
    margin: 0;
  }

  .new-event-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    background-color: var(--primary-color);
    color: var(--text-white);
    padding: 8px;
    border-radius: 3px;
    font-size: 8px;
    font-weight: 500;
  }

  .event-list {
    display: flex;
    flex-direction: column;
    gap: 22px;
    max-height: 520px; /* Chiều cao tối đa của vùng cuộn */
    overflow-y: auto;  /* Cho phép cuộn khi vượt quá */
    scrollbar-gutter: stable; /* Giữ chỗ cố định cho thanh cuộn (nếu được hỗ trợ) */
  }

  .event-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 10px;
    font-weight: 600;
    padding: 4px;
    border-radius: 3px;
  }

  .event-list li:hover {
    background-color: #f0f0f0;
  }

  .event-list li.active {
    background-color: var(--primary-color);
    color: var(--text-white);
  }

  .event-list .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .event-list li.active .dot {
    background-color: #fff !important;
  }

  .event-list::-webkit-scrollbar {
    width: 0px;
    background: transparent;
  }


  .sidebar-bottom {
    border-top: 1px solid var(--border-color);
    padding: 16px 20px;
  }

  .recycle-bin-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    text-decoration: none;
    font-size: 15px;
    font-weight: 500;
    color: #333;
    border-radius: 8px;
    transition: all 0.25s ease;
  }

  .recycle-bin-link img {
    width: 20px;
    height: 20px;
    transition: transform 0.25s ease, filter 0.25s ease;
  }

  .recycle-bin-link:hover {
    background-color: #f0f0ff;         /* nền tím nhạt khi hover */
    color: #4629f2;                   /* chữ đổi sang tím chủ đạo */
    transform: translateX(4px);       /* trượt nhẹ sang phải */
  }

  .recycle-bin-link:hover img {
    transform: rotate(-10deg) scale(1.1);  /* icon nghiêng nhẹ và to lên chút */
    filter: hue-rotate(25deg) brightness(1.1);
  }

  .content-panel {
    flex-grow: 1;
    padding: 14px 0;
    display: flex;
    flex-direction: column;
  }
  .content-header {
    display: flex;
    align-items: center;
    gap: 13px;
    padding-left: 30px;
    padding-top: 10px;
  }
  .content-header h1 {
    font-size: 18px;
    font-weight: 500;
    margin: 0;
  }
  .empty-state {
    flex-grow: 1;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .empty-state p {
    font-size: 20px;
    font-weight: 500;
    color: var(--color-text-secondary);
  }

.recycle-event-list {
  padding: 10px 20px;
  margin-top: 15px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.recycle-event {
  background-color: #f8f9fa;
  border: 1px solid #ddd;
  border-left: 5px solid rgb(95, 65, 143);
  padding: 12px 16px;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: transform 0.25s ease, box-shadow 0.25s ease, background-color 0.25s ease;
}

.recycle-event:hover {
  transform: translateY(-3px);
  background-color: #ffffff;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
  border-color: #7c31d8ff;
}


.recycle-event-info {
  font-size: 16px;
  color: #2c2c2c;
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
}

.event-color-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
  box-shadow: 0 0 6px rgba(0,0,0,0.15);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.event-color-dot:hover {
  transform: scale(1.2);
  box-shadow: 0 0 10px rgba(121,21,174,0.5);
}

.recycle-buttons {
  display: flex;
  gap: 12px;
  margin-top: 8px;
}

.recycle-buttons button {
  padding: 8px 16px;
  font-size: 14px;
  font-weight: 500;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
.restore-btn {
  background: linear-gradient(135deg, #b36bd8, #c98fe4);
  color: #fff;
}

.restore-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(179,107,216,0.35);
}
.perma-delete-btn {
  background: linear-gradient(135deg, #7915ae, #a334d0);
  color: #fff;
}

.perma-delete-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(121,21,174,0.4);
}
/* Modal nền */
.modal {
  display: none; /* ẩn mặc định */
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(3px);
  background-color: rgba(0, 0, 0, 0.4);
  justify-content: center;
  align-items: center;
}

/* Khung modal */
.modal-content {
  background: #fff;
  border-radius: 12px;
  padding: 24px;
  width: 320px;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  animation: fadeInUp 0.3s ease;
}

.modal-content h3 {
  margin-bottom: 10px;
  font-size: 18px;
  color: #2c2c2c;
}

.modal-content p {
  margin-bottom: 20px;
  font-size: 14px;
  color: #555;
}

.modal-actions {
  display: flex;
  justify-content: space-between;
  gap: 12px;
}

.modal-actions button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.25s ease;
}

#cancelBtn {
  background: #e0e0e0;
  color: #333;
}

#cancelBtn:hover {
  background: #d6d6d6;
}

#confirmDeleteBtn {
  background: linear-gradient(135deg, #7915ae, #a334d0);
  color: #fff;
}

#confirmDeleteBtn:hover {
  box-shadow: 0 4px 10px rgba(121, 21, 174, 0.3);
  transform: translateY(-2px);
}

/* Hiệu ứng hiện lên */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}


  </style>
  <script src="global.js" defer></script>
</head>
<body>
<section id="section-header">
  <header class="site-header">
    <div class="container header-container">
      <a href="{% url 'home' %}" class="logo">
        <img src="{% static 'event/recycle-bin-event/images/24489db95d7c8b23ff71ea38f01643e97c6a9ede.png' %}" alt="Lucenda Logo" class="logo-img">
      </a>
      <nav class="main-nav">
        <ul>
          <li><a href="{% url 'home' %}">Home</a></li>
          <li><a href="{% url 'event_main' %}">Event</a></li>
          <li><a href="{% url 'calendar' %}">Calendar</a></li>
          <li><a href="{% url 'about' %}">About us</a></li>
        </ul>
      </nav>
      <div class="profile-section">
        <a href="{% url 'profile' %}">
          {% if haslogin %}
            <span class="profile-name">{{ haslogin }}</span>
          {% else %}
            <span class="profile-name">Login/Signup</span>
          {% endif %}
          <img src="{% static 'event/recycle-bin-event/images/299_23747.svg' %}" alt="User avatar" class="profile-avatar">
        </a>
      </div>
    </div>
  </header>
</section>
<div class="event-view-wrapper">
  <aside class="sidebar">
  <div class="sidebar-top">
    <div class="calendar-widget">
      <div class="calendar-header">
        <img src="{% static 'event/main-event/images/38_56003.svg' %}" alt="Calendar icon">
        <h2 id="month-name">Month <span class="year">Year</span></h2>
      </div>
      <div class="calendar-grid">
        <div class="day-name">m</div>
        <div class="day-name">t</div>
        <div class="day-name">w</div>
        <div class="day-name">t</div>
        <div class="day-name">f</div>
        <div class="day-name">s</div>
        <div class="day-name">s</div>
        <!-- Dates will be inserted by JS -->
      </div>
    </div>
    <div class="events-section">
    </div>
    </div>

    <div class="sidebar-bottom">
      <a href="#" class="recycle-bin-link">
        <img src="{% static 'event/recycle-bin-event/images/38_55975.svg' %}" alt="Trash can icon">
        <span>Recycle Bin</span>
      </a>
    </div>
  </aside>
    <main class="content-panel" id="recycle-bin">
      <div class="content-header">
        <img src="{% static 'event/recycle-bin-event/images/38_55975.svg' %}" alt="Recycle Bin Icon">
        <h1>Recycle Bin</h1>
      </div>

      <div id="confirmModal" class="modal">
        <div class="modal-content">
          <h3>Are you sure?</h3>
          <p>This event will be permanently deleted.</p>
          <div class="modal-actions">
            <button id="cancelBtn">Cancel</button>
            <button id="confirmDeleteBtn">Delete</button>
          </div>
        </div>
      </div>

  <div class="recycle-event-list" id="recycleEventList">
    <!-- Nội dung sẽ được cập nhật bằng script -->

  <!-- Modal (ẩn mặc định) -->

  </div>
    </main>

</div>
</body>

<script>
  // Calendar generation script
  function generateCalendar() {
    const today = new Date();
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth();
    const currentDate = today.getDate();

    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    const monthTitle = document.getElementById("month-name");
    monthTitle.innerHTML = `${monthNames[currentMonth]} <span class="year">${currentYear}</span>`;

    const firstDay = new Date(currentYear, currentMonth, 1);
    const startDay = (firstDay.getDay() + 6) % 7; // Monday = 0
    const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();

    const prevLastDate = new Date(currentYear, currentMonth, 0).getDate();

    const calendarGrid = document.querySelector(".calendar-grid");

    // Xóa các ngày cũ
    document.querySelectorAll(".date-num").forEach(el => el.remove());

    // Tổng cộng 35 ô
    for (let i = 0; i < 35; i++) {
      const dateEl = document.createElement("div");
      dateEl.classList.add("date-num");

      const dateNum = i - startDay + 1;

      if (i < startDay) {
        // Ngày của tháng trước
        dateEl.textContent = prevLastDate - (startDay - i - 1);
        dateEl.classList.add("dimmed");
      } else if (dateNum > lastDate) {
        // Ngày của tháng sau
        dateEl.textContent = String(dateNum - lastDate).padStart(2, '0');
        dateEl.classList.add("dimmed");
      } else {
        // Ngày của tháng hiện tại
        dateEl.textContent = String(dateNum).padStart(2, '0');
        if (dateNum === currentDate) {
          dateEl.classList.add("today");
        }
      }

      calendarGrid.appendChild(dateEl);
    }
  }

  generateCalendar();


async function loadDeletedEvents() {
  const recycleList = document.getElementById("recycleEventList");

  try {
    const response = await fetch("/api/deleted-events/");
    const events = await response.json();

    recycleList.innerHTML = ""; 

    if (!events || events.length === 0) {
      recycleList.innerHTML = `<p>There are no deleted events.</p>`;
      return;
    }

    events.forEach(eventName => {
      const eventDiv = document.createElement("div");
      eventDiv.classList.add("recycle-event");

      eventDiv.innerHTML = `
        <div class="recycle-event-info">
          <span class="event-color-dot" style="background-color: #7915aeff;"></span>
          ${eventName}
        </div>
        <div class="recycle-buttons">
          <button class="restore-btn">Restore</button>
          <button class="perma-delete-btn">Delete Forever</button>
        </div>
      `;

      recycleList.appendChild(eventDiv);
    });
  } catch (error) {
    recycleList.innerHTML = `<p style="color:red;">Lỗi khi tải dữ liệu</p>`;
    console.error("Error loading events:", error);
  }
}

// Gọi khi load trang
document.addEventListener("DOMContentLoaded", loadDeletedEvents);

// ✅ Event delegation cho nút Restore
// Khôi phục sự kiện đã xóa
document.getElementById("recycleEventList").addEventListener("click", async function(e) {
  if (e.target.classList.contains("restore-btn")) {
    const container = e.target.closest(".recycle-event");
    const eventInfo = container.querySelector(".recycle-event-info");
    const eventName = eventInfo.textContent.trim();

    try {
      const response = await fetch("/restore-event/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie("csrftoken")
        },
        body: JSON.stringify({ eventName })
      });

      const data = await response.json();

      if (data.success) {
        container.remove();
      } else {
        alert("Restore failed: " + (data.error || ""));
      }
    } catch (err) {
      console.error("Error:", err);
    }
  }
});

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== "") {
    const cookies = document.cookie.split(";");
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.startsWith(name + "=")) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// ✅ Event delegation cho nút Delete Forever
// Xóa vĩnh viễn sự kiện
document.getElementById("recycleEventList").addEventListener("click", async function(e) {
  if (e.target.classList.contains("perma-delete-btn")) {
    const container = e.target.closest(".recycle-event");
    const eventInfo = container.querySelector(".recycle-event-info");
    const eventName = eventInfo.textContent.trim();

    // Lấy modal
    const modal = document.getElementById("confirmModal");
    const cancelBtn = document.getElementById("cancelBtn");
    const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

    // Hiển thị modal
    modal.style.display = "flex";

    // Khi nhấn Cancel → đóng modal
    cancelBtn.onclick = function () {
      modal.style.display = "none";
    };

    confirmDeleteBtn.onclick = async function () {
      modal.style.display = "none";
      try {
        const response = await fetch("/delete-event1/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken")
          },
          body: JSON.stringify({ eventName })
        });

        const data = await response.json();

        if (data.success) {
          container.remove();
        } else {
          alert("Delete failed: " + (data.error || ""));
        }
      } catch (err) {
        console.error("Error:", err);
        alert("Có lỗi khi gửi yêu cầu xóa.");
      }
    };

    // Khi click ra ngoài modal → đóng modal
    window.onclick = function(event) {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    };  
  }
});

// Hàm lấy CSRF token (bạn đã có sẵn)
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== "") {
    const cookies = document.cookie.split(";");
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.startsWith(name + "=")) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

</script>
</html>