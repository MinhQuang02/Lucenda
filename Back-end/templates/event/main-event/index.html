{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event - Lucenda</title>
  <link rel="icon" type="image/png" href="{% static 'images/logo.svg' %}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@275;400;500;600;700&family=Roboto:wght@400&family=Inter:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'event/main-event/global.css' %}">
  <style id="sections-styles">
/* CSS for section section:header */
.site-header {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 10;
  background: linear-gradient(to left, rgba(220, 140, 216, 0.96), rgba(232, 150, 249, 0.96));
  height: var(--header-height);
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 100%;
  position: relative;
}

.logo {
  position: absolute;
  left: 20px;
  top: -27px;
  width: 129px;
  height: 129px;
  z-index: 11;
}

.logo img {
  width: 100%;
  height: 100%;
  transition: transform 0.3s ease;
  transform-origin: center center; /* phóng từ giữa ảnh */
  cursor: pointer;
}

.logo img:hover {
  transform: scale(1.05); /* phóng to ra ngoài, không bị cắt */
}
.main-nav {
  flex-grow: 1;
  margin-left: 165px; /* Space for the absolute positioned logo */
}

.main-nav ul {
  display: flex;
  gap: 40px;
}

.main-nav a {
  /* style_27 */
  font-size: 20px;
  font-weight: 500;
  /* NOTE: Text color from JSON is #ffffff, which has poor contrast on the light header background. Using a darker color for visibility based on the image. */
  color: #1f1f1f;
}

.profile-section {
  display: flex;
  align-items: center;
}

.profile-section a {
  display: flex;
  align-items: center;
  gap: 12px; /* khoảng cách giữa chữ và ảnh */
  text-decoration: none;
  color: inherit;
}

.profile-name {
  /* style_26 */
  font-size: 20px;
  font-weight: 500;
  /* NOTE: Text color from JSON is #ffffff. Using a darker color for visibility. */
  color: #1f1f1f;
}

.profile-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%; /* style_25 */
}

.mobile-nav-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 12;
}

.mobile-nav-toggle .bar {
    display: block;
    width: 25px;
    height: 3px;
    margin: 5px auto;
    background-color: #1f1f1f;
}

/* Responsive Header */
@media (max-width: 1024px) {
  .main-nav {
    margin-left: 180px;
  }
  .main-nav ul {
    gap: 20px;
  }
}

@media (max-width: 880px) {
  .main-nav, .profile-section {
    display: none; /* Hide for mobile, to be handled by JS */
  }
  .mobile-nav-toggle {
    display: block;
  }
  .header-container {
    justify-content: flex-end;
  }
  .logo {
    left: 30px;
    width: 100px;
    height: 100px;
    top: -10px;
  }
}
.site-header {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 10;
  background: linear-gradient(to left, rgba(220, 140, 216, 0.96), rgba(232, 150, 249, 0.96));
  height: var(--header-height);
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 100%;
  position: relative;
}

.logo {
  position: absolute;
  left: 20px;
  top: -27px; /* Hangs off the top based on Figma coordinates */
  width: 129px;
  height: 129px;
  z-index: 11;
}

.logo img {
  width: 100%;
  height: 100%;
}

.main-nav {
  flex-grow: 1;
  margin-left: 165px; /* Space for the absolute positioned logo */
}

.main-nav ul {
  display: flex;
  gap: 40px;
}

.main-nav a {
  font-size: 18px;
  font-weight: 500;
  color: #1f1f1f; /* chữ trắng tím nhạt */
  position: relative;
  transition: color 0.3s ease;
}

.main-nav a::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 0;
  height: 2px;
  background: #b62db6ff;
  transition: width 0.3s ease;
}

.main-nav a:hover {
  color: #b62db6ff; /* tím nhạt sáng hơn khi hover */
}

.main-nav a:hover::after {
  width: 100%; /* gạch chân tím khi hover */
}

.profile-section a {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  color: #1f1f1f;
  transition: color 0.3s ease, transform 0.2s ease;
}

.profile-section a:hover {
  color: #b62db6ff;
  transform: translateY(-1px); /* nổi nhẹ khi hover */
}

.profile-name {
  font-size: 18px;
  font-weight: 500;
}

.profile-avatar {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #b62db6ff;
  padding: 2px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform 0.3s ease;
}

.profile-avatar:hover {
  transform: scale(1.1);
}


.mobile-nav-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 12;
}

.mobile-nav-toggle .bar {
    display: block;
    width: 25px;
    height: 3px;
    margin: 5px auto;
    background-color: #1f1f1f;
}

/* Responsive Header */
@media (max-width: 1024px) {
  .main-nav {
    margin-left: 180px;
  }
  .main-nav ul {
    gap: 20px;
  }
}

@media (max-width: 880px) {
  .main-nav, .profile-section {
    display: none; /* Hide for mobile, to be handled by JS */
  }
  .mobile-nav-toggle {
    display: block;
  }
  .header-container {
    justify-content: flex-end;
  }
  .logo {
    left: 30px;
    width: 100px;
    height: 100px;
    top: -10px;
  }
}

/* CSS for section section:event-view */
.event-view-wrapper {
    display: flex;
    min-height: calc(100vh - 86px); /* Full height minus header */
    margin-top: 82px;
  }

  .sidebar {
    width: 262px;
    flex-shrink: 0;
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .sidebar-top {
    padding: 27px 20px 0;
  }

  .calendar-widget {
    padding-bottom: 27px;
  }

  .calendar-header {
    display: flex;
    align-items: center;
    gap: 7px;
    margin-bottom: 10px;
  }

  .calendar-header h2 {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-light);
    margin: 0;
  }

  .calendar-header .year {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px 4px;
    text-align: center;
  }

  .day-name {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-light);
    opacity: 0.7;
    text-transform: capitalize;
  }

  .date-num {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-light);
    padding: 5px;
    border-radius: 99px;
  }

  .date-num.today {
    background: linear-gradient(135deg, #e4d4f8, #c1a3e7); /* tím nhạt -> tím đậm */
    color: white;
    font-weight: bold;
  }

  .date-num.active {
    background-color: var(--primary-color);
    color: var(--text-white);
  }

  .date-num.dimmed  {
    opacity: 0.3;
  }

  .events-section {
    padding-top: 27px;
    border-top: 1px solid var(--border-color);
  }

  .events-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .events-title {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .events-title h3 {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-light);
    margin: 0;
  }

  .new-event-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    background: linear-gradient(135deg, #d1b8eaff, #c9a8f7ff);
    color: var(--text-white);
    padding: 8px;
    border-radius: 4px;
    font-size: 8px;
    font-weight: 500;
  }

  .new-event-btn img {
    width: 16px;
    height: 16px;
    transition: transform 0.25s ease;
  }

  .new-event-btn:hover {
    background: linear-gradient(135deg, #bf9ce2ff, #9f72deff);
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px); /* nổi lên nhẹ */
  }

  .new-event-btn:hover img {
    transform: rotate(180deg);
    transition: transform 0.5s ease-in-out;
  }

  .new-event-btn:active {
    transform: scale(0.97); /* nhấn xuống */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .event-list {
    display: flex;
    flex-direction: column;
    gap: 22px;
    max-height: 520px; /* Chiều cao tối đa của vùng cuộn */
    overflow-y: auto;  /* Cho phép cuộn khi vượt quá */
    scrollbar-gutter: stable; /* Giữ chỗ cố định cho thanh cuộn (nếu được hỗ trợ) */
  }

  .event-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 10px;
    font-weight: 600;
    padding: 4px;
    border-radius: 3px;
  }

  .event-list li:hover {
    background-color: #f0f0f0;
  }

  .event-list li.active {
    background: linear-gradient(135deg, #c1a3e7, rgba(177, 136, 230, 1)); 
    color: var(--text-white);
  }

  .event-list .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .event-list li.active .dot {
    background-color: #fff !important;
  }

  .event-list::-webkit-scrollbar {
    width: 0px;
    background: transparent;
  }



  .sidebar-bottom {
    border-top: 1px solid var(--border-color);
    padding: 16px 20px;
  }

  .recycle-bin-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    text-decoration: none;
    font-size: 15px;
    font-weight: 500;
    color: #333;
    border-radius: 8px;
    transition: all 0.25s ease;
  }

  .recycle-bin-link img {
    width: 20px;
    height: 20px;
    transition: transform 0.25s ease, filter 0.25s ease;
  }

  .recycle-bin-link:hover {
    background-color: #f0f0ff;         /* nền tím nhạt khi hover */
    color: #4629f2;                   /* chữ đổi sang tím chủ đạo */
    transform: translateX(4px);       /* trượt nhẹ sang phải */
  }

  .recycle-bin-link:hover img {
    transform: rotate(-10deg) scale(1.1);  /* icon nghiêng nhẹ và to lên chút */
    filter: hue-rotate(25deg) brightness(1.1);
  }

  #editableTitle {
    outline: none;
    border: none;
    background: transparent;
    cursor: text;
    padding: 0;
    margin: 0;
    display: inline-block;
    font-size: 24px;
    font-weight: bold;
    user-select: text;
  }


  .main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding: 24px 24px 20px 24px;
  }

  .content-body {
    flex-grow: 1;
  }

  .event-title-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding-bottom: 21px;
    border-bottom: 1px solid var(--border-color);
  }

  .event-title-header h1 {
    font-size: 26px;
    font-weight: 600;
    margin: 0;
  }

  h1 .author {
    margin-left: 10px;
    font-size: 1.1rem;
    font-weight: 400;
    color: #7f8c8d; /* màu xám nhạt */
  }

  .notification-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
    font-weight: 500;
    margin-top: 2px;
    color: #2d2d2d;
    font-family: "Segoe UI", Roboto, sans-serif;
    cursor: pointer;
    user-select: none;
    transition: color 0.2s ease;
  }

  /* Style riêng cho nút chuông */
  #notification-btn {
    background: none;
    border: none;
    padding: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.25s ease;
  }

  #notification-btn img {
    width: 26px;
    height: 26px;
    transition: transform 0.25s ease, filter 0.25s ease;
  }

  /* Hover toàn bộ toggle */
  .notification-toggle:hover {
    color: #9429f2ff;
  }

  /* Khi hover thì icon chuông đổi màu + phóng to */
  .notification-toggle:hover #notification-btn img {
    transform: scale(1.15);
    filter: hue-rotate(250deg) brightness(1.2); /* đổi màu tím */
  }


  .event-meta {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 21px 0;
    border-bottom: 1px solid var(--border-color);
  }

  .event-time {
    display: flex;
    align-items: center;
    gap: 8px;
    border: none;
    background-color: transparent;
    cursor: pointer;
    font-size: 1rem;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background-color 0.2s;
  }

  .event-time:hover {
    background-color: #f0f0f0;
  }

  .event-time img {
    width: 20px;
    height: 20px;
  }

  .dropdown-container {
    position: relative;
    display: inline-block;
  }

.each-week-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  border: 1px solid var(--primary-color);
  color: var(--primary-color);
  padding: 8px 10px;
  border-radius: 5px;
  font-size: 13px;
  font-weight: 500;
  background: #fff;
  cursor: pointer;
  transition: all 0.25s ease;
}

.each-week-btn img {
  width: 14px;
  height: 14px;
  transition: transform 0.25s ease;
}

.each-week-btn:hover {
  background-color: rgba(70, 41, 242, 0.08);  /* tím nhạt */
  border-color: #4629f2;
  color: #4629f2;
  transform: translateY(-1px);                /* nổi nhẹ lên */
  box-shadow: 0 2px 6px rgba(0,0,0,0.12);
}

.each-week-btn:hover img {
  transform: rotate(-90deg);   /* icon mũi tên xoay xuống */
}

.dropdown-options {
  display: none;
  position: absolute;
  top: 110%;
  left: 0;
  z-index: 20;
  background-color: #fff;
  border: 1px solid #ddd;
  min-width: 160px;
  border-radius: 6px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  padding: 6px 0;
  font-family: "Segoe UI", Roboto, sans-serif;
  font-size: 14px;
  animation: fadeIn 0.2s ease;
}

.dropdown-options div {
  padding: 10px 14px;
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
  color: #333;
}

.dropdown-options div:hover {
  background-color: #f0f0ff;   /* tím nhạt để đồng bộ */
  color: #4629f2;              /* tím chủ đạo */
}

/* Custom input block */
.dropdown-options .custom-day-input {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px 14px;
  border-top: 1px solid #eee;
}

.dropdown-options .custom-day-input label {
  font-size: 13px;
  color: #555;
}

.dropdown-options .custom-day-input input {
  width: 60px;
  padding: 5px 6px;
  font-size: 13px;
  border: 1px solid #ccc;
  border-radius: 4px;
  outline: none;
  transition: border-color 0.2s;
}
.dropdown-options .custom-day-input input:focus {
  border-color: #4629f2;
}

.dropdown-options .custom-day-input button {
  padding: 5px 10px;
  font-size: 13px;
  border: none;
  border-radius: 4px;
  background-color: #4629f2;
  color: #fff;
  cursor: pointer;
  transition: background-color 0.2s;
}
.dropdown-options .custom-day-input button:hover {
  background-color: #3a21cc;
}

/* Hiệu ứng mở */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}


  .custom-day-input {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 8px 12px;
    border-top: 1px solid #ccc;
  }

  .custom-day-input input {
    width: 50px;
    padding: 4px;
  }

  .custom-day-input button {
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
  }

  .date-created {
    margin-left: auto;
    font-size: 16px;
    font-weight: 275;
  }

  .event-sharing {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 21px 0;
    border-bottom: 1px solid var(--border-color);
  }

  .share-search-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: #ece6f0;
    padding: 11px 16px;
    border-radius: 28px;
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    color: #49454f;
  }

  .avatar, .avatar-overflow {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 400;
    border: 2px solid var(--background-light);
  }
  
  .avatar:not(:first-child), .avatar-overflow:not(:first-child) {
    margin-left: -8px;
  }

  .avatar {
    background-color: var(--avatar-bg);
    color: var(--avatar-text);
  }

  .avatar-overflow {
    background-color: #f5f5f5;
    color: #757575;
  }

  .event-details-section {
    padding-top: 21px;
  }

  .event-details-section h2 {
    font-size: 26px;
    font-weight: 600;
    margin: 0 0 13px 0;
  }

  .event-details-textarea {
    width: 100%;
    height: 525px;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 6px;
    resize: vertical; /* Cho phép kéo chiều cao */
    font-family: inherit;
  }
  
  .content-footer { 
    display: flex; 
    justify-content: flex-end; 
    align-items: center; 
    gap: 40px; 
    padding-top: 10px; 
    border-top: 1px solid var(--border-color); 
    margin-top: auto; /* Pushes footer to the bottom */ 
  }

  .content-footer button {
    background: none;
    border: none;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  /* Delete button */
  .delete-btn {
    font-size: 20px;
    font-weight: 275;
    color: var(--text-dark);
  }

  .delete-btn:hover {
    background-color: #f0d7f8ff;
    color: #b724d1ff;
    transform: translateY(-1px);
  }

  /* Save button */
  .save-btn {
    font-size: 22px;
    font-weight: 700;
    color: #603f77ff;
  }

  .save-btn:hover {
    background-color: #c798eeff;
    color: #2e1b55;
    transform: translateY(-1px);
  }


  @media (max-width: 1200px) {
    .event-meta {
      flex-wrap: wrap;
    }
    .date-created {
      margin-left: 0;
      width: 100%;
      text-align: right;
    }
  }

  @media (max-width: 992px) {
    .event-view-wrapper {
      flex-direction: column;
    }
    .sidebar {
      width: 100%;
      border-right: none;
      border-bottom: 1px solid var(--border-color);
    }
    .main-content {
      padding: 20px;
    }
  }

  @media (max-width: 768px) {
    .header-container {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    .site-header {
      height: auto;
      padding: 10px;
    }
    .logo img {
      width: 80px;
      height: 80px;
      margin-top: 0;
    }
    .main-nav ul {
      gap: 20px;
    }
    .main-nav a, .profile-name {
      font-size: 16px;
    }
    .profile-section {
      align-self: flex-end;
    }
    .event-meta, .event-sharing {
      flex-direction: column;
      align-items: flex-start;
    }
    .date-created {
      text-align: left;
    }
  }
  #eventTimePicker {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  #floatingDropdown {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 14px;
    padding: 22px 20px 18px;
    width: 340px;
    box-shadow: 0 8px 28px rgba(0, 0, 0, 0.25);
    z-index: 9999;
    display: none;
    font-family: "Segoe UI", Roboto, sans-serif;
    animation: fadeInScale 0.25s ease;
  }

  #floatingDropdown h3 {
    margin: 0 0 12px 0;
    font-size: 18px;
    font-weight: 600;
    color: #2d2d2d;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
  }

  #floatingDropdown ul {
    list-style: none;
    padding: 0;
    margin: 12px 0;
    max-height: 160px;
    overflow-y: auto;
  }

  #floatingDropdown li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 4px;
    font-size: 14px;
    color: #333;
    border-bottom: 1px solid #f2f2f2;
  }

  #floatingDropdown input {
    width: 100%;
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  #floatingDropdown input:focus {
    border-color: #4629f2;
    box-shadow: 0 0 0 2px rgba(70, 41, 242, 0.15);
  }

  #floatingDropdown .close-btn {
    position: absolute;
    top: 16px;
    right: 18px;
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
    transition: color 0.2s, transform 0.2s;
  }

  #floatingDropdown .close-btn:hover {
    color: #4629f2;
    transform: scale(1.1);
  }

  /* Hiệu ứng mở popup */
  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: translate(-50%, -48%) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
  }


.modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
.modal.hidden {
  display: none;
}
.modal-content {
  background: #fff;
  padding: 24px;
  border-radius: 12px;
  width: 320px;
  height: 230px;
  text-align: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  font-family: 'Segoe UI', sans-serif;
}

/* Tiêu đề */
.modal-content h3 {
  margin-bottom: 20px;
  font-size: 18px;
  font-weight: 600;
  color: #4a148c; /* tím đậm nhìn sang */
}

/* Ô nhập */
.modal-content input {
  width: 100%;
  padding: 10px 12px;
  margin-bottom: 20px;
  border: 1.5px solid #ddd;
  border-radius: 8px;
  font-size: 14px;
  outline: none;
  transition: border 0.2s;
}
.modal-content input:focus {
  border-color: #7e57c2; /* tím nhẹ khi focus */
}

/* Nhóm nút */
.modal-actions {
  display: flex;
  justify-content: center;
  gap: 12px;
}

/* Nút */
.modal-actions button {
  flex: 1;
  padding: 10px 0;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}

#cancelBtn {
  background: #b39ddb;
  color: #fff;
}
#cancelBtn:hover {
  background: #9575cd;
}

#addBtn {
  background: #7e57c2;
  color: #fff;
}
#addBtn:hover {
  background: #5e35b1;
}

.modal-actions button:active {
  transform: scale(0.96);
}

/* CSS cho popup */
.alert-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.alert-content {
  background: #fff;
  padding: 20px 30px;
  border-radius: 12px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  text-align: center;
  font-family: 'Poppins', sans-serif;
  max-width: 300px;
}

.alert-content p {
  margin-bottom: 15px;
  font-size: 15px;
  color: #333;
}

.alert-content button {
  padding: 8px 16px;
  border: none;
  background: #ba62e3ff;
  color: #fff;
  border-radius: 6px;
  cursor: pointer;
}

.alert-content button:hover {
  background: #8f00b3ff;
}

/* Container trên góc phải */
#mini-scene-container {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  z-index: 9999;
}

/* Toast cơ bản */
.mini-scene {
  min-width: 220px;
  background: #6a1b9a; /* fallback tím */
  color: white;
  padding: 12px 18px;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 500;
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
}

/* Khi hiện ra */
.mini-scene.show {
  opacity: 1;
  transform: translateY(0);
}

/* Các biến thể tím */
.mini-scene.info {
  background: #7e57c2; /* tím nhạt */
}
.mini-scene.success {
  background: #5e35b1; /* tím trung tính */
}
.mini-scene.warning {
  background: #8e24aa; /* tím hơi hồng */
}
.mini-scene.error {
  background: #4a148c; /* tím đậm */
}

#toast-container {
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  background: rgba(70, 41, 242, 0.95);
  color: #fff;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  opacity: 0;
  transform: translateY(20px);
  animation: slideIn 0.4s forwards, fadeOut 0.4s 3s forwards;
}

@keyframes slideIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeOut {
  to {
    opacity: 0;
    transform: translateY(20px);
  }
}

  </style>
  <script src="global.js" defer></script>
</head>
<body>
<section id="section-header">
  <header class="site-header">
    <div class="container header-container">
      <a href="{% url 'home' %}" class="logo">
        <img src="{% static 'event/main-event/images/24489db95d7c8b23ff71ea38f01643e97c6a9ede.png' %}" alt="Lucenda Logo" class="logo-img">
      </a>
      <nav class="main-nav">
        <ul>
          <li><a href="{% url 'home' %}">Home</a></li>
          <li><a href="{% url 'event_main' %}">Event</a></li>
          <li><a href="{% url 'calendar' %}">Calendar</a></li>
          <li><a href="{% url 'about' %}">About us</a></li>
        </ul>
      </nav>
      <div class="profile-section">
        <a href="{% url 'profile' %}">
          {% if haslogin %}
            <span class="profile-name">{{ haslogin }}</span>
          {% else %}
            <span class="profile-name">Login/Signup</span>
          {% endif %}
          <img src="{% static 'event/main-event/images/299_23747.svg' %}" alt="User avatar" class="profile-avatar">
        </a>
      </div>
    </div>
  </header>
</section>
<div class="event-view-wrapper">
  <aside class="sidebar">
  <div class="sidebar-top">
    <div class="calendar-widget">
      <div class="calendar-header">
        <img src="{% static 'event/main-event/images/38_56003.svg' %}" alt="Calendar icon">
        <h2 id="month-name">Month <span class="year">Year</span></h2>
      </div>
      <div class="calendar-grid">
        <div class="day-name">m</div>
        <div class="day-name">t</div>
        <div class="day-name">w</div>
        <div class="day-name">t</div>
        <div class="day-name">f</div>
        <div class="day-name">s</div>
        <div class="day-name">s</div>
        <!-- Dates will be inserted by JS -->
      </div>
    </div>
    <div class="events-section">
      <div class="events-header">
        <div class="events-title">
          <img src="{% static 'event/main-event/images/38_55997.svg' %}" alt="List icon">
          <h3>Events</h3>
        </div>
        <button class="new-event-btn">
          <span>New event</span>
          <img src="{% static 'event/main-event/images/I38_56315_2_85399.svg' %}" alt="Add icon">
        </button>
      </div>

      <!-- Danh sách sự kiện sẽ render bằng JS -->
      <ul class="event-list scrollable" id="eventList"></ul>
    </div>
    </div>
    <!-- Modal nhập sự kiện -->
    <div id="eventModal" class="modal hidden">
      <div class="modal-content">
        <h3>Add new event</h3>
        <input type="text" id="eventInput" placeholder="Enter event name...">
        <div class="modal-actions">
          <button id="cancelBtn">Cancel</button>
          <button id="addBtn">Add</button>
        </div>
      </div>
  </div>
    <div class="sidebar-bottom">
      <a href="{% url 'event_recycle' %}" class="recycle-bin-link">
        <img src="{% static 'event/main-event/images/38_55975.svg' %}" alt="Trash can icon">
        <span>Recycle Bin</span>
      </a>
    </div>
  </aside>
  <main class="main-content">
    <div class="content-body">
      <div class="event-title-header">
        <h1>
          <span id="editableTitle" contenteditable="true">Title of the Event can be edited</span>
          <span class="author" contenteditable="false"> — by User</span>
        </h1>

      <div class="notification-toggle">
        <button id="notification-btn" type="button">
          <img src="{% static 'event/main-event/images/185_24914.svg' %}" alt="Notification bell">
        </button>
        <span id="notification-text">Enable</span>
      </div>
      </div>
      <div class="event-meta">
        <!-- Thẻ giống như button để chọn ngày giờ -->
        <button class="event-time" id="eventTimeBtn">
          <img src="{% static 'event/main-event/images/38_56434.svg' %}" alt="Clock icon">
          <span id="eventTimeText">Event Due Date</span>
        </button>

        <!-- Input chọn ngày giờ, sẽ bị ẩn đi -->
        <input type="datetime-local" id="eventTimePicker" style="display: none;">

        <div class="dropdown-container">
          <button class="each-week-btn" onclick="toggleDropdown()">
            <span id="selected-option">Each Week</span>
            <img src="{% static 'event/main-event/images/I40_129276_2_85414.svg' %}" alt="Dropdown arrow">
          </button>
          <div id="dropdown" class="dropdown-options">
            <div onclick="selectOption('Each Day')">Each Day</div>
            <div onclick="selectOption('Each Week')">Each Week</div>
            <div onclick="selectOption('Each Month')">Each Month</div>
            <div onclick="selectOption('Each Year')">Each Year</div>
            <div class="custom-day-input">
              <label for="dayInput">Each</label>
              <input type="number" id="dayInput" min="1" max="1000" placeholder="days" />
              <button onclick="applyCustomDays()">Apply</button>
            </div>
          </div>
        </div>
        <div id="toast-container"></div>

        <span class="date-created">Time Created: MMM dd, yyyy hh:mm</span>
      </div>
      <div class="event-sharing">
        <div class="share-search-bar" onclick="toggleFloatingDropdown()">
          <img src="{% static 'event/main-event/images/I186_23756_52977_33950_57994_10133_57994_9720.svg' %}" alt="Share icon">
          <span>Event shared with...&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>
      </div>
      <div class="event-details-section">
        <h2>Event Detail</h2>
        <textarea class="event-details-textarea" placeholder="Write detail of the event..."></textarea>
        <br>
        <br>
      </div>
      <!-- Popup thông báo -->
      <div id="alertModal" class="alert-modal">
        <div class="alert-content">
          <p>Please select an event before deleting.</p>
          <button id="closeAlert">OK</button>
        </div>
      </div>
    </div>
    <footer class="content-footer">
      <button class="delete-btn">Delete</button>
      <button class="save-btn">Save</button>
    </footer>
  </main>
</div>
</body>
<script>
  var id_event_now = null; // Biến toàn cục để lưu ID sự kiện hiện tại
  // Dropdown for each week/month...
  function toggleDropdown() {
    const dropdown = document.getElementById("dropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  }

  function selectOption(option) {
    document.getElementById("selected-option").innerText = option;
    document.getElementById("dropdown").style.display = "none";
  }
  function showToast(message) {
    const container = document.getElementById("toast-container");
    const toast = document.createElement("div");
    toast.className = "toast";
    toast.innerText = message;
    container.appendChild(toast);

    // Tự xóa sau 3.5s
    setTimeout(() => {
      toast.remove();
    }, 3500);
  }
  function applyCustomDays() {
    const input = document.getElementById("dayInput");
    const value = parseInt(input.value);
    if (!isNaN(value) && value >= 1 && value <= 1000) {
      selectOption(`Each ${value} days`);
    } else {
      showToast("Please enter a number between 1 and 1000.");
    }
  }

  // Optional: Hide dropdown if clicked outside
  window.addEventListener("click", function(e) {
    const dropdown = document.getElementById("dropdown");
    const button = document.querySelector(".each-week-btn");
    if (!dropdown.contains(e.target) && !button.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });

  // Calendar generation script
  function generateCalendar() {
    const today = new Date();
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth();
    const currentDate = today.getDate();

    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    const monthTitle = document.getElementById("month-name");
    monthTitle.innerHTML = `${monthNames[currentMonth]} <span class="year">${currentYear}</span>`;

    const firstDay = new Date(currentYear, currentMonth, 1);
    const startDay = (firstDay.getDay() + 6) % 7; // Monday = 0
    const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();

    const prevLastDate = new Date(currentYear, currentMonth, 0).getDate();

    const calendarGrid = document.querySelector(".calendar-grid");

    // Xóa các ngày cũ
    document.querySelectorAll(".date-num").forEach(el => el.remove());

    // Tổng cộng 35 ô
    for (let i = 0; i < 35; i++) {
      const dateEl = document.createElement("div");
      dateEl.classList.add("date-num");

      const dateNum = i - startDay + 1;

      if (i < startDay) {
        // Ngày của tháng trước
        dateEl.textContent = prevLastDate - (startDay - i - 1);
        dateEl.classList.add("dimmed");
      } else if (dateNum > lastDate) {
        // Ngày của tháng sau
        dateEl.textContent = String(dateNum - lastDate).padStart(2, '0');
        dateEl.classList.add("dimmed");
      } else {
        // Ngày của tháng hiện tại
        dateEl.textContent = String(dateNum).padStart(2, '0');
        if (dateNum === currentDate) {
          dateEl.classList.add("today");
        }
      }

      calendarGrid.appendChild(dateEl);
    }
  }

  generateCalendar();

  // Editable title functionality
    const editableTitle = document.getElementById("editableTitle");
  const maxLength = 50;

  editableTitle.addEventListener("input", function () {
    if (this.innerText.length > maxLength) {
      this.innerText = this.innerText.slice(0, maxLength);

      // Đặt lại con trỏ về cuối
      const range = document.createRange();
      const sel = window.getSelection();
      range.selectNodeContents(this);
      range.collapse(false);
      sel.removeAllRanges();
      sel.addRange(range);
    }
  });

  editableTitle.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      e.preventDefault(); // Chặn xuống dòng
    }
  });

  // Chỉnh lịch tới hạn của sự kiện
  const eventTimeBtn = document.getElementById("eventTimeBtn");
  const eventTimeText = document.getElementById("eventTimeText");
  const eventTimePicker = document.getElementById("eventTimePicker");

  eventTimeBtn.addEventListener("click", () => {
    eventTimePicker.showPicker(); // Mở bộ chọn ngày giờ trên trình duyệt
  });

  eventTimePicker.addEventListener("change", () => {
    const value = eventTimePicker.value;
    if (value) {
      const date = new Date(value);
      const options = {
        day: '2-digit',
        month: 'long',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      };
      const formatted = date.toLocaleString('en-US', options);
      eventTimeText.textContent = formatted;
    }
  });

  // Dropdown của phần shared event
  var sharedUsers = [];

  function toggleFloatingDropdown() {
    let dropdown = document.getElementById("floatingDropdown");

    if (!dropdown) {
      dropdown = document.createElement("div");
      dropdown.id = "floatingDropdown";
      dropdown.innerHTML = `
        <button class="close-btn" onclick="toggleFloatingDropdown()">×</button>
        <h3>Event shared with</h3>
        <ul id="sharedList"></ul>
        <input type="text" id="newUserInput" placeholder="Enter new id user..." />
      `;
      document.body.appendChild(dropdown);

      const input = dropdown.querySelector("#newUserInput");
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const name = input.value.trim();
          if (name) {
            sharedUsers.push(name);
            input.value = "";
            renderSharedUsers();
          }
        }
      });
    }

    const isVisible = dropdown.style.display === "block";
    dropdown.style.display = isVisible ? "none" : "block";

    if (!isVisible) renderSharedUsers();
  }

  function renderSharedUsers() {
    const list = document.getElementById("sharedList");
    list.innerHTML = "";
    sharedUsers.forEach((user, index) => {
      const li = document.createElement("li");
      li.innerHTML = `
        <span>${user}</span>
        <button onclick="removeUser(${index})">❌</button>
      `;
      list.appendChild(li);
    });
  }

  function removeUser(index) {
    sharedUsers.splice(index, 1);
    renderSharedUsers();
  }

  // Thêm sự kiện mới và mở ra ô nhỏ để nhập tên sự kiện
  const eventList = document.querySelector(".event-list");
  const newEventBtn = document.querySelector(".new-event-btn");

  // Modal elements
  const modal = document.getElementById("eventModal");
  const eventInput = document.getElementById("eventInput");
  const cancelBtn = document.getElementById("cancelBtn");
  const addBtn = document.getElementById("addBtn");

  // Mở modal khi bấm "New event"
  newEventBtn.addEventListener("click", () => {
    eventInput.value = "";
    modal.classList.remove("hidden");
    eventInput.focus();
  });

  // Đóng modal
  cancelBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
  });

    // Thêm sự kiện mới
  addBtn.addEventListener("click", () => {
    const newEventName = eventInput.value.trim();
    if (!newEventName) return;

    // Gửi request lên server
    fetch("/api/events/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie("csrftoken") // cần cho Django
      },
      body: JSON.stringify({ name: newEventName })
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === "success") {
        // Random màu tone tím + xanh biển nhạt
        const colors = [
          "#9C27B0", // tím đậm
          "#BA68C8", // tím pastel
          "#7E57C2", // tím xanh
          "#3F51B5", // xanh dương
          "#5C6BC0", // xanh tím
          "#64B5F6", // xanh biển nhạt
          "#90CAF9", // xanh pastel
        ];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];

        // Tạo li mới trên giao diện
        const newLi = document.createElement("li");
        newLi.classList.add("clickable");
        newLi.innerHTML = `<span class="dot" style="background-color: ${randomColor};"></span> ${newEventName}`;

        newLi.addEventListener("click", () => {
          document.querySelectorAll(".event-list li").forEach(li => li.classList.remove("active"));
          newLi.classList.add("active");
        });

        eventList.appendChild(newLi);
        modal.classList.add("hidden"); // đóng modal sau khi thêm
        location.reload();
      } else {
        alert("Không thể tạo sự kiện: " + data.message);
      }
    })
    .catch(err => {
      console.error("Error:", err);
      alert("Không thể tạo sự kiện. Vui lòng thử lại.");
    });
  });

  // Hàm lấy CSRF token
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + "=")) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // Xóa event
  // Xóa sự kiện đã chọn
  const deleteBtn = document.querySelector(".delete-btn");
  const alertModal = document.getElementById("alertModal");
  const closeAlert = document.getElementById("closeAlert");

  // Sự kiện nút OK trong modal
  closeAlert.addEventListener("click", () => {
    alertModal.style.display = "none";
  });

  // Xóa sự kiện
  alertModal.style.display = "none";
  deleteBtn.addEventListener("click", () => {
    if (id_event_now === null) {
      // Hiện popup cảnh báo
      alertModal.style.display = "flex";
      return;
    }

    const activeItem = document.querySelector(".event-list li.active");
    if (!activeItem) return;

    const eventName = activeItem.textContent.trim(); // tên event đang active

    // --- Gửi request lên server ---
    fetch("/delete-event/", {
      method: "POST", // hoặc DELETE nếu bạn muốn RESTful hơn
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie("csrftoken"), // nếu dùng Django thì cần CSRF token
      },
      body: JSON.stringify({ name: eventName }),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error("Có lỗi khi xóa sự kiện trên server");
        }
        return response.json();
      })
      .then((data) => {
        console.log("Server response:", data);

        // Nếu server xóa thành công thì xóa khỏi giao diện
        const parent = activeItem.parentElement;
        activeItem.remove();
        location.reload();
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("Xóa sự kiện thất bại!");
      });
  });

  // Hàm lấy CSRF token (nếu backend là Django)
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // Cập nhập các sự kiện có từ máy chủ
  document.addEventListener("DOMContentLoaded", () => {
    const eventList = document.getElementById("eventList");

    // Random màu tone tím & xanh nhạt
    function getRandomColor() {
      const colors = ["#6A5ACD", "#7B68EE", "#9370DB", "#87CEFA", "#00BFFF", "#4682B4"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // Render 1 sự kiện chỉ với tên
    function renderEvent(name) {
      const li = document.createElement("li");
      li.classList.add("clickable");
      li.innerHTML = `
        <span class="dot" style="background-color: ${getRandomColor()};"></span>
        ${name}
      `;

      li.addEventListener("click", () => {
        document.querySelectorAll(".event-list li").forEach(li => li.classList.remove("active"));
        li.classList.add("active");
      });

      eventList.appendChild(li);
    }

    // Gọi API lấy danh sách sự kiện (chỉ có name)
    fetch("/api_display/events/", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie("csrftoken")
      }
    })
    .then(response => response.json())
    .then(data => {
      eventList.innerHTML = ""; // clear cũ
      data.forEach(event => renderEvent(event.name_event));
    })
    .catch(err => {
      console.error("Error loading events:", err);
      eventList.innerHTML = "<li>Cannot load the events</li>";
    });

    // Lấy CSRF token
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + "=")) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  });

  // Chỉnh sửa nội dung của event khi ấn vào một event
  // Bắt click trên UL .event-list, phân biệt LI nào được click
  document.querySelectorAll('.event-list').forEach(listEl => {
    listEl.addEventListener('click', (e) => {
      const li = e.target.closest('li.clickable');
      if (!li || !listEl.contains(li)) return; // click ngoài LI thì bỏ

      // 1) Highlight: bỏ active cũ, set active mới
      const prev = listEl.querySelector('li.active');
      if (prev) prev.classList.remove('active');
      li.classList.add('active');

      // 2) Lấy tên event từ LI
      const eventName = li.dataset.event || li.textContent.trim();

      // 3) Gọi API lấy dữ liệu chi tiết theo tên
      fetch(`/get-event-data?name=${encodeURIComponent(eventName)}`)
        .then(res => {
          if (!res.ok) throw new Error('Network error');
          return res.json();
        })
        .then(data => {
          // 4) Đổ dữ liệu vào UI
          id_event_now = data.id_event || "null"; // Lưu ID sự kiện hiện tại

          const titleEl = document.getElementById('editableTitle');
          if (titleEl) titleEl.textContent = data.title || '';

          const authorEl = document.querySelector('.author');
          if (authorEl) authorEl.textContent = ` — by ${data.author_id || ''}`;

          const notifSpan = document.querySelector('.notification-toggle span');
          if (notifSpan) notifSpan.textContent = data.notification ? 'Enable' : 'Disable';

          const timeText = document.getElementById('eventTimeText');
          if (timeText) timeText.textContent = data.time_event || '';

          const repeatEl = document.getElementById('selected-option');
          if (data.loop === "2000-01-01") {
            if (repeatEl) repeatEl.textContent = "Each Week" || '';
          } 
          else if (data.loop === "2000-01-02") {
            if (repeatEl) repeatEl.textContent = "Each Month" || '';
          }
          else if (data.loop === "2000-01-03") {
            if (repeatEl) repeatEl.textContent = "Each Year" || '';
          }
          else if (data.loop === "2000-01-04") {
            if (repeatEl) repeatEl.textContent = "Each Day" || '';
          }
          else {
            const loopDate = new Date(data.loop);
            const year = loopDate.getFullYear(); // Lấy năm 2000
            if (repeatEl) repeatEl.textContent = "Each " + year + " days" || '';
          }

          const createdEl = document.querySelector('.date-created');
          if (createdEl) createdEl.textContent = `Time Created: ${data.date_created || ''}`;

          const detailEl = document.querySelector('.event-details-textarea');
          if (detailEl) detailEl.value = data.detail || '';

          // Hiển thị danh sách ID được share qua sharedUsers
          sharedUsers = data.shared_ids || [];
        })
        .catch(err => console.error('Error fetching event data:', err));
    });
  });

  // Chuyển thông báo bật/tắt
  document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("notification-btn");
    const text = document.getElementById("notification-text");

    btn.addEventListener("click", function() {
      if (text.textContent.trim() === "Enable") {
        text.textContent = "Disable";
      } else {
        text.textContent = "Enable";
      }
    });
  });

  // Lưu dữ liệu sự kiện
  const saveBtn = document.querySelector(".save-btn");

  saveBtn.addEventListener("click", () => {
    // Nếu chưa chọn event thì báo lỗi
    if (id_event_now === null) {
      showMiniScene("Please select an event before saving!", "warning");
      return;
    }

    // Lấy dữ liệu từ DOM
    const title = document.getElementById("editableTitle").innerText.trim();
    const author = document.querySelector(".author").innerText.replace("— by ", "").trim();
    const notification = document.getElementById("notification-text").innerText.trim();
    const repeatTime = document.getElementById("selected-option").innerText.trim();
    const dueTime = document.getElementById("eventTimeText").innerText.trim();
    const createdTime = document.querySelector(".date-created").innerText.replace("Time Created: ", "").trim();
    const sharedList = sharedUsers;
    const detail = document.querySelector(".event-details-textarea").value.trim();

    // Đóng gói data
    const data = {
      event_id: id_event_now,
      title: title,
      author: author,
      notification: notification,
      repeat_time: repeatTime,
      due_time: dueTime,
      created_time: createdTime,
      shared_list: sharedList,
      detail: detail
    };

    // Gửi lên server (POST request)
    fetch("/api/save_event/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie("csrftoken") // nếu dùng Django CSRF
      },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(result => {
      showMiniScene("Event saved successfully!", "success");
    })
    .catch(err => {
      console.error(err);
      showMiniScene("Error occurred while saving!", "error");
    });
  });

  // Hàm show mini scene
  function showMiniScene(message, type = "info") {
    // Container chứa tất cả toast
    let container = document.getElementById("mini-scene-container");
    if (!container) {
      container = document.createElement("div");
      container.id = "mini-scene-container";
      document.body.appendChild(container);
    }

    // Tạo toast
    const mini = document.createElement("div");
    mini.className = `mini-scene ${type}`;
    mini.innerText = message;
    container.appendChild(mini);

    // Hiện với hiệu ứng
    setTimeout(() => {
      mini.classList.add("show");
    }, 50);

    // Auto ẩn sau 3s
    setTimeout(() => {
      mini.classList.remove("show");
      setTimeout(() => mini.remove(), 300);
    }, 3000);
  }



  // Hàm lấy CSRF Token trong Django
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + "=")) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  </script>

</html>